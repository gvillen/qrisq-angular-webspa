<div>
  <agm-map
    [latitude]="userLattitude"
    [longitude]="userLongitude"
    [restriction]="restriction"
    [zoom]="zoom"
    [mapTypeId]="'hybrid'"
    [disableDefaultUI]="true"
    (mapReady)="mapReady($event)"
  >
    <ng-container *ngIf="mode === 'summary'">
      <agm-data-layer
        [geoJson]="surgeGeoJSON"
        [style]="surgeStyleFunc"
      ></agm-data-layer>
      <agm-data-layer
        [geoJson]="lineGeoJSON"
        [style]="lineStyleFunc"
      ></agm-data-layer>

      <agm-data-layer
        [geoJson]="pointsGeoJSON"
        [style]="pointsStyleFunc"
      ></agm-data-layer>

      <agm-data-layer
        [geoJson]="polygonsGeoJSON"
        [style]="polygonsStyleFunc"
      ></agm-data-layer>

      <agm-polyline strokeColor="#fff" strokeWeight="3" zIndex="40">
        <agm-polyline-point
          [latitude]="userLattitude"
          [longitude]="userLongitude"
        >
        </agm-polyline-point>
        <agm-polyline-point
          [latitude]="stormLattitude"
          [longitude]="stormLongitude"
        >
        </agm-polyline-point>
      </agm-polyline>
    </ng-container>

    <ng-container *ngIf="mode === 'surge'">
      <agm-data-layer
        [geoJson]="surgeGeoJSON"
        [style]="surgeStyleFunc"
      ></agm-data-layer>
    </ng-container>

    <ng-container *ngIf="mode === 'wind'">
      <agm-data-layer
        [geoJson]="windGeoJSON"
        [style]="windStyleFunc"
      ></agm-data-layer>
    </ng-container>

    <div id="property-surge-risk">
      <ng-container *ngIf="mode === 'summary' || mode === 'surge'">
        <img src="assets/images/property-surge-risk.png" />
      </ng-container>
    </div>
    <div id="legend-water-depth">
      <ng-container *ngIf="mode === 'summary' || mode === 'surge'">
        <img src="assets/images/legend-water-depth.png" />
      </ng-container>
    </div>

    <div id="property-wind-risk">
      <ng-container *ngIf="mode === 'wind' || mode === 'vortex'">
        <img src="assets/images/property-wind-risk.png" />
      </ng-container>
    </div>

    <agm-marker
      [latitude]="userLattitude"
      [longitude]="userLongitude"
      [iconUrl]="levels[surgeRisk].iconUrl"
    >
    </agm-marker>

    <!-- [iconUrl]="getUserLocationIcon(surgeRisk)" -->

    <div id="select-map-layer">
      <h1>Select Map Layer</h1>
      <label
        nz-checkbox
        [(ngModel)]="isTrackAndConeChecked"
        [nzDisabled]="activeLayer === 'wind' || activeLayer === 'vortex'"
        >Track and Cone</label
      >
      <nz-radio-group [(ngModel)]="activeLayer">
        <label nz-radio nzValue="surge">Storm Surge</label>
        <label nz-radio nzValue="wind">Max Winds</label>
        <label nz-radio nzValue="vortex">Wind Vortex</label>
      </nz-radio-group>
    </div>

    <div id="map-settings">
      <div
        class="button"
        *ngIf="activeLayer === 'vortex' && isSettingsVisible === false"
      >
        <button
          nz-button
          nzType="primary"
          nzShape="circle"
          nzSize="large"
          (click)="onSettingsClick($event)"
        >
          <i nz-icon nzType="setting" nzTheme="outline"></i>
        </button>
      </div>

      <div
        class="form"
        *ngIf="activeLayer === 'vortex' && isSettingsVisible === true"
      >
        <div class="form-item">
          <h4>Velocity Scale</h4>
          <nz-slider
            [(ngModel)]="vortexConfig.velocityScale"
            (nzOnAfterChange)="onVelocityScaleAfterChange($event)"
            [nzMin]="0.01"
            [nzMax]="0.05"
            [nzStep]="0.01"
          ></nz-slider>
        </div>

        <div class="form-item">
          <h4>Intensity Scale Step</h4>
          <nz-slider
            [(ngModel)]="vortexConfig.intensityScaleStep"
            (nzOnAfterChange)="onIntensityScaleStepAfterChange($event)"
            [nzStep]="1"
          ></nz-slider>
        </div>

        <div class="form-item">
          <h4>Max Wind Intensity</h4>
          <nz-slider
            [(ngModel)]="vortexConfig.maxWindIntensity"
            (nzOnAfterChange)="onMaxWindIntensityAfterChange($event)"
            [nzStep]="1"
          ></nz-slider>
        </div>

        <div class="form-item">
          <h4>Max Particle Age</h4>
          <nz-slider
            [(ngModel)]="vortexConfig.maxParticleAge"
            (nzOnAfterChange)="onMaxParticleAgeAfterChange($event)"
            [nzStep]="1"
          ></nz-slider>
        </div>

        <div class="form-item">
          <h4>Particle Line Width</h4>
          <nz-slider
            [(ngModel)]="vortexConfig.particleLineWidth"
            (nzOnAfterChange)="onParticleLineWidthAfterChange($event)"
            [nzStep]="0.01"
            [nzMin]="0.01"
            [nzMax]="1"
          ></nz-slider>
        </div>

        <div class="form-item">
          <h4>Particle Multiplier 1/x</h4>
          <nz-slider
            [(ngModel)]="vortexConfig.particleMultiplier"
            (nzOnAfterChange)="onParticleMultiplierAfterChange($event)"
            [nzStep]="1"
          ></nz-slider>
        </div>

        <div class="form-item">
          <h4>Particle Reduction</h4>
          <nz-slider
            [(ngModel)]="vortexConfig.particleReduction"
            (nzOnAfterChange)="onParticleReductionAfterChange($event)"
            [nzStep]="0.1"
          ></nz-slider>
        </div>

        <div class="form-item">
          <h4>Frame Rate</h4>
          <nz-slider
            [(ngModel)]="vortexConfig.frameRate"
            (nzOnAfterChange)="onFrameRateAfterChange($event)"
            [nzStep]="1"
          ></nz-slider>
        </div>

        <!-- //   velocityScale: 0.08,
          //   intensityScaleStep: 2,
          //   maxWindIntensity: 10,
          //   maxParticleAge: 50,
          //   particleLineWidth: 0.15,
          //   particleMultiplier: 1 / 30,
          //   particleReduction: 0.8,
          //   frameRate: 20, -->
      </div>
    </div>
  </agm-map>
</div>
